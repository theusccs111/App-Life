
@{
    ViewBag.Title = "Index";
}


<script>
    setTimeout(function () {
        $('.alert').fadeOut('fast');
    }, 3000);

</script>




@if (Session["menuPro"].ToString() == "Objeto")
{
    <ul class="nav nav-tabs">
        <li ><a data-toggle="tab" href="#home">Receitas</a></li>
        <li><a data-toggle="tab" href="#menu1">Despesas</a></li>
        <li><a data-toggle="tab" href="#menu2">Gráficos</a></li>
        <li class="active"><a data-toggle="tab" href="#menu3">Objetivo</a></li>

    </ul>

    <script>
        $(function () {
            $('#menu3').addClass('in');
            $('#menu3').addClass('active');
        });
    </script>

    Session["menuPro"] = "nada";
}
else
{
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#home">Receitas</a></li>
        <li><a data-toggle="tab" href="#menu1">Despesas</a></li>
        <li><a data-toggle="tab" href="#menu2">Gráficos</a></li>
        <li><a data-toggle="tab" href="#menu3">Objetivo</a></li>

    </ul>
    <script>
        $(function () {
            $('#home').addClass('in');
            $('#home').addClass('active');
        });
    </script>
    Session["menuPro"] = "nada";
}


<div class="tab-content">

    <div id="home" class="tab-pane fade">

        <div id="cabeçalho" class="cab" style="color:#337ab7;">
            <h2>Projeção de Receitas</h2>
            <p style="background:#e8e8e8; padding: 10px;">Lançamento de projeções de receitas</p>
            </div>

            <div class="col-md-12">
                <div class="col-md-2" style="width:210px; padding-right:0px; padding-top:6px; font-family: 'Open Sans', 'Helvetica Neue',
            Arial, sans-serif; border: none; font-weight: 700; color:#337ab7;">
                    Escolha o mês de exibição
                </div>
                <div class="col-md-2" style="padding-left:0px;">
                    <select id="mesReceitaP" class="form-control">
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Março</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                <div class="col-md-2">

                    <button id="enviarReceitaP" class="btn btn-primary btn-block"><span class="fa fa-list"></span><span style="font-family: 'Open Sans', 'Helvetica Neue', Arial, sans-serif; border: none; font-weight: 700;"> Exibir</span></button>
                </div>
            </div>

        @if (Session["messProjetadoR"].ToString() == "Incluido")
        {
            <div class="alert" style="margin-top: 5%; background-color: #4CAF50;">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                Projeção Incluída com sucesso!
            </div>
            Session["messProjetadoR"] = "nada";

        }

        @if (Session["messProjetadoR"].ToString() == "Deletado")
        {
            <div class="alert" style="margin-top: 5%;">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                Projeção Deletada com sucesso!
            </div>
            Session["messProjetadoR"] = "nada";

        }

        @if (Session["messProjetadoR"].ToString() == "Atualizado")
        {
            <div class="alert" style="margin-top: 5%; background-color: #2196F3;">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                Projeção Atualizada com sucesso!
            </div>
            Session["messProjetadoR"] = "nada";

        }


            <div id="ReceitaP">

            </div>
        </div>
    <div id="menu1" class="tab-pane fade">

        <div id="cabeçalho" class="cab" style="color:#337ab7;">
            <h2>Projeção de Despesas</h2>
            <p style="background:#e8e8e8; padding: 10px;">Lançamento de projeções de despesas</p>
            </div>

            <div class="col-md-12">
                <div class="col-md-2" style="width:210px; padding-right:0px; padding-top:6px; font-family: 'Open Sans', 'Helvetica Neue',
            Arial, sans-serif; border: none; font-weight: 700; color:#337ab7;">
                    Escolha o mês de exibição
                </div>
                <div class="col-md-2" style="padding-left:0px;">
                    <select id="mesDespesaP" class="form-control">
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Março</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button id="enviarDespesaP" class="btn btn-primary btn-block"><span class="fa fa-list"></span><span style="font-family: 'Open Sans', 'Helvetica Neue', Arial, sans-serif; border: none; font-weight: 700;"> Exibir</span></button>
                </div>
            </div>

      @if (Session["messProjetadoD"].ToString() == "Incluido")
      {
        <div class="alert" style="margin-top: 5%; background-color: #4CAF50;">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            Projeção Incluída com sucesso!
        </div>
          Session["messProjetadoD"] = "nada";

      }

    @if (Session["messProjetadoD"].ToString() == "Deletado")
    {
        <div class="alert" style="margin-top: 5%;">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            Projeção Deletada com sucesso!
        </div>
        Session["messProjetadoD"] = "nada";

    }

    @if (Session["messProjetadoD"].ToString() == "Atualizado")
    {
        <div class="alert" style="margin-top: 5%; background-color: #2196F3;">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            Projeção Atualizada com sucesso!
        </div>
        Session["messProjetadoD"] = "nada";

    }
            <div id="DespesaP">

            </div>
        </div>
    <div id="menu2" class="tab-pane fade">

        <div id="cabeçalho" class="cab" style="color:#337ab7;">
            <h2>Gráficos</h2>
            <p style="background:#e8e8e8; padding: 10px;">Resumo de projeções das receitas e despesas</p>
        </div>

        <table id="tabelaProjetado2" class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline" cellspacing="0" style="width: 100%; display:none;">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th>Data</th>
                    <th class="sorting" tabindex="0" aria-controls="dataTables-example"
                        rowspan="1" colspan="1" aria-label="Valor:active to sort column ascending"
                        style="width: 171px">
                        Valor
                    </th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (ViewBag.listaProjetadoD2))
                {
                    <tr>
                        <td id="@item.ProjetadoID">
                            @item.ProjetadoID
                        </td>
                        <td>
                            @item.categoria.nome
                        </td>
                        <td>
                            @item.Descricao
                        </td>
                        <td>
                            @item.Data
                        </td>
                        <td>
                            @item.Valor
                        </td>
                        <td>

                            <a href="@Url.Action("ProjetadoDelete","Projetado",new { id = @item.ProjetadoID})" class="btn btn-danger">

                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                            </a>
                            <button class="btn btn-primary edit eita" data-id="@item.ProjetadoID"><i class="glyphicon glyphicon-edit"></i></button>
                    </tr>
                }
            </tbody>
        </table>

        <table id="tabelaProjetado" class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline" cellspacing="0" style="width: 100%; display: none;">
            <thead>
                <tr>

                    <th style="display:none">Código</th>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th>Data</th>
                    <th class="sorting" tabindex="0" aria-controls="dataTables-example"
                        rowspan="1" colspan="1" aria-label="Valor:active to sort column ascending"
                        style="width: 171px">
                        Valor
                    </th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in (ViewBag.listaProjetadoR2))
                {
                    <tr>
                        <td id="@item.ProjetadoID" style="display:none">
                            @item.ProjetadoID
                        </td>
                        <td>
                            @item.categoria.nome
                        </td>
                        <td>
                            @item.Descricao
                        </td>
                        <td>
                            @item.Data
                        </td>
                        <td>
                            @item.Valor
                        </td>

                        <td>

                            <a href="@Url.Action("ProjetadoDelete","Projetado",new { id = @item.ProjetadoID})" class="btn btn-danger">

                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                            </a>
                            <button class="btn btn-primary edit eita" data-id="@item.ProjetadoID"><i class="glyphicon glyphicon-edit"></i></button>

                    </tr>
                }
            </tbody>
        </table>

        <script>



            sessionStorage.clear();
            var linha = document.getElementById('tabelaProjetado').rows;
            var dados = null;
            for (var i = 1 ; i < linha.length ; i++) {
                dados = linha[i].cells;
                for (var j = 0 ; j < dados.length ; j++) {
                    sessionStorage.setItem('categoria' + [i], dados[j + 1].innerText);
                    sessionStorage.setItem('descricao' + [i], dados[j + 2].innerText);
                    sessionStorage.setItem('data' + [i], dados[j + 3].innerText);
                    sessionStorage.setItem('valor' + [i], dados[j + 4].innerText);
                    break;
                }
            }


            var linha = document.getElementById('tabelaProjetado2').rows;
            var dados = null;
            for (var i = 1 ; i < linha.length ; i++) {
                dados = linha[i].cells;
                for (var j = 0 ; j < dados.length ; j++) {
                    sessionStorage.setItem('categoriad' + [i], dados[j + 1].innerText);
                    sessionStorage.setItem('descricaod' + [i], dados[j + 2].innerText);
                    sessionStorage.setItem('datad' + [i], dados[j + 3].innerText);
                    sessionStorage.setItem('valord' + [i], dados[j + 4].innerText);
                    break;
                }
            }



            var array = [];
            var array2 = [];
            var array3 = [];
            var array4 = [];

            var array5 = [];
            var array6 = [];
            var array7 = [];
            var array8 = [];

            for (var i = 1; i < sessionStorage.length; i++) {
                if ((sessionStorage.getItem('valor' + [i]) != null) && (sessionStorage.getItem('descricao' + [i]) != null)) {
                    array[i] = sessionStorage.getItem('valor' + [i]);
                    array2[i] = sessionStorage.getItem('descricao' + [i]);
                    array3[i] = sessionStorage.getItem('categoria' + [i]);
                    array4[i] = sessionStorage.getItem('data' + [i]);
                }
            }

            for (var i = 1; i < sessionStorage.length; i++) {
                if ((sessionStorage.getItem('valord' + [i]) != null) && (sessionStorage.getItem('descricaod' + [i]) != null)) {
                    array5[i] = sessionStorage.getItem('valord' + [i]);
                    array6[i] = sessionStorage.getItem('descricaod' + [i]);
                    array7[i] = sessionStorage.getItem('categoriad' + [i]);
                    array8[i] = sessionStorage.getItem('datad' + [i]);
                }
            }


            google.charts.setOnLoadCallback(drawChart);

            google.charts.load('43', { 'packages': ['corechart'], 'language': 'pt-br' });
            function drawChart() {

                var data = new google.visualization.DataTable();
                data.addColumn('string', 'data');
                //    data.addColumn('string', 'Receitas');
                data.addColumn('number', 'Valor');

                var data2 = new google.visualization.DataTable();
                data2.addColumn('string', 'data');
                // data.addColumn('string', 'Receitas');
                data2.addColumn('number', 'Valor');



                for (var i = 1; i < array.length; i++) {

                    data.addRows([
                    [String(array4[i]), parseFloat(array[i])]

                    ]);
                }

                for (var i = 1; i < array5.length; i++) {

                    data2.addRows([
                    [String(array8[i]), parseFloat(array5[i])]

                    ]);
                }



                var options = {
                    title: 'Receita',
                    vAxis: { format: 'currency' },
                    hAxis: { textPosition: 'none' },
                    seriesType: 'bars',
                    'width': 900,
                    'height': 400,
                    colors: ['green']


                };


                var options2 = {
                    title: 'Despesa',
                    vAxis: { format: 'currency' },
                    hAxis: { textPosition: 'none' },
                    seriesType: 'bars',
                    'width': 900,
                    'height': 400,
                    colors: ['red']
                };


                var chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
                chart.draw(data, options);

                var chart2 = new google.visualization.ComboChart(document.getElementById('chart_div2'));
                chart2.draw(data2, options2);



            }

        </script>


        <div class="container">


            <div class="col-md-12">
                <div id="chart_div" style="width: 100%; height:100%;">
                </div>
            </div>
        </div>
        <div class="container">
            <div class="col-md-12">
                <div id="chart_div2" style="width: 100%; height:100%;">
                </div>
            </div>

        </div>


    </div>

    <div id="menu3" class="tab-pane fade">
        <div id="Objetivo">
            @Html.Partial("_Objetivo")
        </div>
    </div>

</div>


<script>


    $('#enviarReceitaP').click(function () {
        var mes = $('#mesReceitaP').val();
        var url = "/Projetado/ProjetadoR?mes=" + mes;

        // alert(mes)
        $.post(url, { mes: mes }, function (data) {
            $("#ReceitaP").html(data);
        });
    })

    $('#enviarDespesaP').click(function () {
        var mes = $('#mesDespesaP').val();
        var url = "/Projetado/ProjetadoD?mes=" + mes;

        //  alert(mes)
        $.post(url, { mes: mes }, function (data) {
            $("#DespesaP").html(data);
        });
    })



</script>